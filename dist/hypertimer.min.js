/**
 * hypertimer.js
 * https://github.com/enmasseio/hypertimer
 *
 * Time control for simulations.
 *
 * Run a timer at a faster or slower pace than real-time, or run discrete events.
 *
 * @version 2.0.1
 * @date    2015-02-26
 *
 * @license
 * Copyright (C) 2014-2015 Almende B.V., http://almende.com
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("ws")):"function"==typeof define&&define.amd?define(["ws"],n):"object"==typeof exports?exports.hypertimer=n(require("ws")):t.hypertimer=n(t.ws)}(this,function(t){return function(t){function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){"use strict";t.exports=e(1)},function(t,n,e){"use strict";function r(t){function n(){return{paced:h,rate:w,deterministic:y,time:g,master:b}}function e(t){if("deterministic"in t&&(y=t.deterministic?!0:!1),"paced"in t&&(h=t.paced?!0:!1),"time"in t&&(O=m(t.time),x=f.systemNow(),r(O),g=new Date(O).toISOString()),"rate"in t){var i=Number(t.rate);if(isNaN(i)||0>=i)throw new TypeError("Invalid rate "+JSON.stringify(t.rate)+". Rate must be a positive number");O=N.now(),x=f.systemNow(),w=i}if("master"in t){var o,a;!function(){var r=function(t){var r=n();e(t);var i=n();N.emit("config",i,r)};if(a={},"string"==typeof t.master)o=t.master;else{o=t.master.url;for(prop in t.master)t.master.hasOwnProperty(prop)&&"url"!==prop&&(a[prop]=t.master.prop)}_&&_.destroy(),_=c(o),_.on("change",function(t){return r({time:t})}),_.on("config",function(t){return r(t)}),_.on("error",function(t){return N.emit("error",t)})}()}"port"in t&&(b=u(N.now,N.config,t.port)),v(),b&&b.broadcastConfig()}function r(t){for(var n=0;n<j.length;n++){var e=j[n];e.type===a.INTERVAL&&s(e,t)}}function s(t,n){t.occurrence=Math.ceil((n-t.firstTime)/t.interval),t.time=t.firstTime+t.occurrence*t.interval}function l(t){if(j.length>0){for(var n=j.length-1;n>=0&&j[n].time>t.time;)n--;j.splice(n+1,0,t)}else j.push(t)}function p(t,n){function e(){t.type===a.INTERVAL&&E[t.id]&&(t.occurrence++,t.time=t.firstTime+t.occurrence*t.interval,l(t)),delete E[t.id],n&&n()}E[t.id]=t;try{0==t.callback.length?(t.callback(),e()):t.callback(e)}catch(r){o(N,"error")?N.emit("error",r):console.log("Error",r),e()}}function d(t){for(var n=0;n<j.length&&(j[n].time<=t||!isFinite(j[n].time));)n++;var e=j.splice(0,n);return 0==y&&f.shuffle(e),e}function v(){if(h||!(Object.keys(E).length>0)){var t=j[0];if(I&&(clearTimeout(I),I=null),T&&t){var n=function(){h||(O=e>O&&isFinite(e)?e:O);var t=d(e);h?(t.forEach(p),v()):!function(){var n=function(){var e=t.shift();e?p(e,n):v()};n()}()},e=t.time,r=e-N.now(),i=h?r/w:0;I=setTimeout(n,Math.round(i))}}}function m(t){var n="number"==typeof t?t:t instanceof Date?t.valueOf():new Date(t).valueOf();if(isNaN(n))throw new TypeError("Invalid date "+JSON.stringify(t)+". Date, number, or ISOString expected");return n}var h=!0,w=1,y=!0,g=null,b=null,_=null,T=!1,x=null,O=f.systemNow(),j=[],E={},I=null,k=0,N=i({});return N.config=function(t){return t&&e(t),n()},N.now=function(){if(h){if(T){var t=f.systemNow()-x,n=t*w;return O+n}return O}return O},N["continue"]=function(){x=f.systemNow(),T=!0,v()},N.pause=function(){O=N.now(),x=null,T=!1,v()},N.getTime=function(){return new Date(N.now())},N.valueOf=N.getTime,N.toString=function(){return N.getTime().toString()},N.setTimeout=function(t,n){var e=k++,r=N.now()+n;if(isNaN(r))throw new TypeError("delay must be a number");return l({id:e,type:a.TIMEOUT,time:r,callback:t}),v(),e},N.setTrigger=function(t,n){var e=k++,r=m(n);return l({id:e,type:a.TRIGGER,time:r,callback:t}),v(),e},N.setInterval=function(t,n,e){var r=k++,i=Number(n);if(isNaN(i))throw new TypeError("interval must be a number");(0>i||!isFinite(i))&&(i=0);var o=void 0!=e?m(e):null,u=N.now(),c=null!=o?o:u+i,f={id:r,type:a.INTERVAL,interval:i,time:c,firstTime:null!=o?o:c,occurrence:0,callback:t};return u>c&&s(f,u),l(f),v(),r},N.clearTimeout=function(t){if(E[t])return void delete E[t];for(var n=0;n<j.length;n++)if(j[n].id===t){j.splice(n,1),v();break}},N.clearTrigger=N.clearTimeout,N.clearInterval=N.clearTimeout,N.list=function(){return j.map(function(t){return t.id})},N.clear=function(){E={},j=[],v()},Object.defineProperty(N,"running",{get:function(){return T}}),N.config(t),N["continue"](),N}var i=e(2),o=e(17),u=e(19).createMaster,c=e(33).createSlave,f=e(34),a={TIMEOUT:0,INTERVAL:1,TRIGGER:2};t.exports=r},function(t,n,e){"use strict";var r,i,o,u,c,f,a,s=e(3),l=e(16),p=Function.prototype.apply,d=Function.prototype.call,v=Object.create,m=Object.defineProperty,h=Object.defineProperties,w=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};r=function(t,n){var e;return l(n),w.call(this,"__ee__")?e=this.__ee__:(e=y.value=v(null),m(this,"__ee__",y),y.value=null),e[t]?"object"==typeof e[t]?e[t].push(n):e[t]=[e[t],n]:e[t]=n,this},i=function(t,n){var e,i;return l(n),i=this,r.call(this,t,e=function(){o.call(i,t,e),p.call(n,this,arguments)}),e.__eeOnceListener__=n,this},o=function(t,n){var e,r,i,o;if(l(n),!w.call(this,"__ee__"))return this;if(e=this.__ee__,!e[t])return this;if(r=e[t],"object"==typeof r)for(o=0;i=r[o];++o)(i===n||i.__eeOnceListener__===n)&&(2===r.length?e[t]=r[o?0:1]:r.splice(o,1));else(r===n||r.__eeOnceListener__===n)&&delete e[t];return this},u=function(t){var n,e,r,i,o;if(w.call(this,"__ee__")&&(i=this.__ee__[t]))if("object"==typeof i){for(e=arguments.length,o=new Array(e-1),n=1;e>n;++n)o[n-1]=arguments[n];for(i=i.slice(),n=0;r=i[n];++n)p.call(r,this,o)}else switch(arguments.length){case 1:d.call(i,this);break;case 2:d.call(i,this,arguments[1]);break;case 3:d.call(i,this,arguments[1],arguments[2]);break;default:for(e=arguments.length,o=new Array(e-1),n=1;e>n;++n)o[n-1]=arguments[n];p.call(i,this,o)}},c={on:r,once:i,off:o,emit:u},f={on:s(r),once:s(i),off:s(o),emit:s(u)},a=h({},f),t.exports=n=function(t){return null==t?v(a):h(Object(t),f)},n.methods=c},function(t,n,e){"use strict";var r,i=e(4),o=e(11),u=e(12),c=e(13);r=t.exports=function(t,n){var e,r,u,f,a;return arguments.length<2||"string"!=typeof t?(f=n,n=t,t=null):f=arguments[2],null==t?(e=u=!0,r=!1):(e=c.call(t,"c"),r=c.call(t,"e"),u=c.call(t,"w")),a={value:n,configurable:e,enumerable:r,writable:u},f?i(o(f),a):a},r.gs=function(t,n,e){var r,f,a,s;return"string"!=typeof t?(a=e,e=n,n=t,t=null):a=arguments[3],null==n?n=void 0:u(n)?null==e?e=void 0:u(e)||(a=e,e=void 0):(a=n,n=e=void 0),null==t?(r=!0,f=!1):(r=c.call(t,"c"),f=c.call(t,"e")),s={get:n,set:e,configurable:r,enumerable:f},a?i(o(a),s):s}},function(t,n,e){"use strict";t.exports=e(5)()?Object.assign:e(6)},function(t){"use strict";t.exports=function(){var t,n=Object.assign;return"function"!=typeof n?!1:(t={foo:"raz"},n(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,n,e){"use strict";var r=e(7),i=e(10),o=Math.max;t.exports=function(t,n){var e,u,c,f=o(arguments.length,2);for(t=Object(i(t)),c=function(r){try{t[r]=n[r]}catch(i){e||(e=i)}},u=1;f>u;++u)n=arguments[u],r(n).forEach(c);if(void 0!==e)throw e;return t}},function(t,n,e){"use strict";t.exports=e(8)()?Object.keys:e(9)},function(t){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t){"use strict";var n=Object.keys;t.exports=function(t){return n(null==t?t:Object(t))}},function(t){"use strict";t.exports=function(t){if(null==t)throw new TypeError("Cannot use null or undefined");return t}},function(t){"use strict";var n=Array.prototype.forEach,e=Object.create,r=function(t,n){var e;for(e in t)n[e]=t[e]};t.exports=function(){var t=e(null);return n.call(arguments,function(n){null!=n&&r(Object(n),t)}),t}},function(t){"use strict";t.exports=function(t){return"function"==typeof t}},function(t,n,e){"use strict";t.exports=e(14)()?String.prototype.contains:e(15)},function(t){"use strict";var n="razdwatrzy";t.exports=function(){return"function"!=typeof n.contains?!1:n.contains("dwa")===!0&&n.contains("foo")===!1}},function(t){"use strict";var n=String.prototype.indexOf;t.exports=function(t){return n.call(this,t,arguments[1])>-1}},function(t){"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},function(t,n,e){"use strict";var r=e(18),i=e(10),o=Object.prototype.hasOwnProperty;t.exports=function(t){var n;return i(t),n=arguments[1],arguments.length>1?o.call(t,"__ee__")&&Boolean(t.__ee__[n]):t.hasOwnProperty("__ee__")&&!r(t.__ee__)}},function(t,n,e){"use strict";var r=e(10),i=Object.prototype.propertyIsEnumerable;t.exports=function(t){var n;r(t);for(n in t)if(i.call(t,n))return!1;return!0}},function(t,n,e){"use strict";var r=e(20),i=e(22);n.createMaster=function(t,n,e){function o(){var t=n();return delete t.time,delete t.master,t}var u=r.Server,c=new u({port:e});return c.on("connection",function(n){var e=i(n);e.on("time",function(n,e){e(t())}),e.send("config",o()),n.emitter=e}),c.broadcast=function(t,n){c.clients.forEach(function(e){e.emitter.send(t,n)})},c.broadcastConfig=function(){c.broadcast("config",o())},console.log("Master listening at ws://localhost:"+e),c}},function(t,n,e){"use strict";t.exports="undefined"==typeof window||"undefined"==typeof window.WebSocket?e(21):window.WebSocket},function(n){n.exports=t},function(t,n,e){"use strict";var r=e(2),i=e(23),o=6e4;t.exports=function(t){function n(n,e){var r={event:n,data:e};t.send(JSON.stringify(r))}function e(n,e){return new i(function(r,i){var c=u(),a={event:n,id:c,data:e};f[c]={resolve:r,reject:i,timeout:setTimeout(function(){delete f[c],i(new Error("Timeout"))},o)},t.send(JSON.stringify(a))})}function u(){return a++}var c=r({socket:t,send:n,request:e});t.onmessage=function(n){var e=n.data,r=JSON.parse(e),i=f[r.id];i?(clearTimeout(i.timeout),delete f[r.id],i.resolve(r.data)):"id"in r?c.emit(r.event,r.data,function(n){var e={id:r.id,data:n};t.send(JSON.stringify(e))}):c.emit(r.event,r.data)};var f={},a=0;return c}},function(t,n,e){"use strict";t.exports="undefined"==typeof window||"undefined"==typeof window.Promise?e(24):window.Promise},function(t,n,e){"use strict";t.exports=e(25),e(30),e(31),e(32)},function(t,n,e){"use strict";function r(t){function n(t){return null===f?void s.push(t):void u(function(){var n=f?t.onFulfilled:t.onRejected;if(null===n)return void(f?t.resolve:t.reject)(a);var e;try{e=n(a)}catch(r){return void t.reject(r)}t.resolve(e)})}function e(t){try{if(t===l)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void o(n.bind(t),e,r)}f=!0,a=t,c()}catch(i){r(i)}}function r(t){f=!1,a=t,c()}function c(){for(var t=0,e=s.length;e>t;t++)n(s[t]);s=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");var f=null,a=null,s=[],l=this;this.then=function(t,e){return new l.constructor(function(r,o){n(new i(t,e,r,o))})},o(t,e,r)}function i(t,n,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof n?n:null,this.resolve=e,this.reject=r}function o(t,n,e){var r=!1;try{t(function(t){r||(r=!0,n(t))},function(t){r||(r=!0,e(t))})}catch(i){if(r)return;r=!0,e(i)}}var u=e(26);t.exports=r},function(t,n,e){(function(n,e){function r(){for(;o.next;){o=o.next;var t=o.task;o.task=void 0;var n=o.domain;n&&(o.domain=void 0,n.enter());try{t()}catch(e){if(a)throw n&&n.exit(),setTimeout(r,0),n&&n.enter(),e;setTimeout(function(){throw e},0)}n&&n.exit()}c=!1}function i(t){u=u.next={task:t,domain:a&&n.domain,next:null},c||(c=!0,f())}var o={task:void 0,next:null},u=o,c=!1,f=void 0,a=!1;if("undefined"!=typeof n&&n.nextTick)a=!0,f=function(){n.nextTick(r)};else if("function"==typeof e)f="undefined"!=typeof window?e.bind(window,r):function(){e(r)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=r,f=function(){s.port2.postMessage(0)}}else f=function(){setTimeout(r,0)};t.exports=i}).call(n,e(27),e(28).setImmediate)},function(t){function n(){}var e=t.exports={};e.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.MutationObserver,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};var r=[];if(n){var i=document.createElement("div"),o=new MutationObserver(function(){var t=r.slice();r.length=0,t.forEach(function(t){t()})});return o.observe(i,{attributes:!0}),function(t){r.length||i.setAttribute("yes","no"),r.push(t)}}return e?(window.addEventListener("message",function(t){var n=t.source;if((n===window||null===n)&&"process-tick"===t.data&&(t.stopPropagation(),r.length>0)){var e=r.shift();e()}},!0),function(t){r.push(t),window.postMessage("process-tick","*")}):function(t){setTimeout(t,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=n,e.addListener=n,e.once=n,e.off=n,e.removeListener=n,e.removeAllListeners=n,e.emit=n,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")}},function(t,n,e){(function(t,r){var i=e(29).nextTick,o=Array.prototype.slice,u={},c=0;"undefined"!=typeof setTimeout&&(n.setTimeout=function(){return setTimeout.apply(window,arguments)}),"undefined"!=typeof clearTimeout&&(n.clearTimeout=function(){clearTimeout.apply(window,arguments)}),"undefined"!=typeof setInterval&&(n.setInterval=function(){return setInterval.apply(window,arguments)}),"undefined"!=typeof clearInterval&&(n.clearInterval=function(){clearInterval.apply(window,arguments)}),n.enroll=function(t,n){t._timeoutID=setTimeout(t._onTimeout,n)},n.unenroll=function(t){clearTimeout(t._timeoutID)},n.active=function(){},n.setImmediate="function"==typeof t?t:function(t){var e=c++,r=arguments.length<2?!1:o.call(arguments,1);return u[e]=!0,i(function(){u[e]&&(r?t.apply(null,r):t.call(null),n.clearImmediate(e))}),e},n.clearImmediate="function"==typeof r?r:function(t){delete u[t]}}).call(n,e(28).setImmediate,e(28).clearImmediate)},function(t){function n(){if(!o){o=!0;for(var t,n=i.length;n;){t=i,i=[];for(var e=-1;++e<n;)t[e]();n=i.length}o=!1}}function e(){}var r=t.exports={},i=[],o=!1;r.nextTick=function(t){i.push(t),o||setTimeout(n,0)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.on=e,r.addListener=e,r.once=e,r.off=e,r.removeListener=e,r.removeAllListeners=e,r.emit=e,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,n,e){"use strict";var r=e(25),i=e(26);t.exports=r,r.prototype.done=function(){var t=arguments.length?this.then.apply(this,arguments):this;t.then(null,function(t){i(function(){throw t})})}},function(t,n,e){"use strict";function r(t){this.then=function(n){return"function"!=typeof n?this:new i(function(e,r){o(function(){try{e(n(t))}catch(i){r(i)}})})}}var i=e(25),o=e(26);t.exports=i,r.prototype=i.prototype;var u=new r(!0),c=new r(!1),f=new r(null),a=new r(void 0),s=new r(0),l=new r("");i.resolve=function(t){if(t instanceof i)return t;if(null===t)return f;if(void 0===t)return a;if(t===!0)return u;if(t===!1)return c;if(0===t)return s;if(""===t)return l;if("object"==typeof t||"function"==typeof t)try{var n=t.then;if("function"==typeof n)return new i(n.bind(t))}catch(e){return new i(function(t,n){n(e)})}return new r(t)},i.all=function(t){var n=Array.prototype.slice.call(t);return new i(function(t,e){function r(o,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var c=u.then;if("function"==typeof c)return void c.call(u,function(t){r(o,t)},e)}n[o]=u,0===--i&&t(n)}catch(f){e(f)}}if(0===n.length)return t([]);for(var i=n.length,o=0;o<n.length;o++)r(o,n[o])})},i.reject=function(t){return new i(function(n,e){e(t)})},i.race=function(t){return new i(function(n,e){t.forEach(function(t){i.resolve(t).then(n,e)})})},i.prototype["catch"]=function(t){return this.then(null,t)}},function(t,n,e){"use strict";var r=e(25),i=e(26);t.exports=r,r.denodeify=function(t,n){return n=n||1/0,function(){var e=this,i=Array.prototype.slice.call(arguments);return new r(function(r,o){for(;i.length&&i.length>n;)i.pop();i.push(function(t,n){t?o(t):r(n)});var u=t.apply(e,i);!u||"object"!=typeof u&&"function"!=typeof u||"function"!=typeof u.then||r(u)})}},r.nodeify=function(t){return function(){var n=Array.prototype.slice.call(arguments),e="function"==typeof n[n.length-1]?n.pop():null,o=this;try{return t.apply(this,arguments).nodeify(e,o)}catch(u){if(null===e||"undefined"==typeof e)return new r(function(t,n){n(u)});i(function(){e.call(o,u)})}}},r.prototype.nodeify=function(t,n){return"function"!=typeof t?this:void this.then(function(e){i(function(){t.call(n,null,e)})},function(e){i(function(){t.call(n,e)})})}},function(t,n,e){"use strict";var r=e(20),i=(e(23),e(22)),o=e(35),u=e(36),c=36e5,f=1e3,a=5;n.createSlave=function(t){function n(){function t(){var t=null;return e(l).then(function(n){return t=n})["catch"](function(t){return console.log(t)}).then(function(){return u.wait(f)}).then(function(){return t})}return u.repeat(t,a).then(function(t){var n=t.filter(function(t){return null!==t}),e=o.median(n)+o.std(n),r=n.filter(function(t){return e>t});return r.length>0?o.mean(r):null}).then(function(t){return l.request("time").then(function(n){var e=n+t;return l.emit("change",e),e})})["catch"](function(t){return l.emit("error",t)})}function e(t){var n=Date.now();return t.request("time").then(function(e){var r=Date.now(),i=(r-n)/2,o=e+i;return p&&(p=!1,t.emit("change",o)),i})}var s=new r(t),l=i(s),p=!0,d=null;return s.onopen=function(){n(),d=setInterval(n,c)},l.destroy=function(){clearInterval(d),d=null,s.close(),s=null},l}},function(t,n){"use strict";n.systemNow="function"==typeof Date.now?function(){return Date.now()}:function(){return(new Date).valueOf()},n.shuffle=function(t){for(var n,e,r=t.length;r;n=Math.floor(Math.random()*r),e=t[--r],t[r]=t[n],t[n]=e);return t}},function(t,n){"use strict";function e(t,n){return t>n?1:n>t?-1:0}function r(t,n){return t+n}function i(t){return t.reduce(r)}function o(t){return i(t)/t.length}function u(t){return Math.sqrt(c(t))}function c(t){if(t.length<2)return 0;var n=o(t);return t.map(function(t){return Math.pow(t-n,2)}).reduce(r)/(t.length-1)}function f(t){if(t.length<2)return t[0];var n=t.slice().sort(e);return n.length%2===0?(t[t.length/2-1]+t[t.length/2])/2:t[(t.length-1)/2]}n.compare=e,n.add=r,n.sum=i,n.mean=o,n.std=u,n.variance=c,n.median=f,Object.defineProperty(n,"__esModule",{value:!0})},function(t,n,e){"use strict";function r(t){return new u(function(n){setTimeout(n,t)})}function i(t,n){return new u(function(e){function r(){n>i?(i++,t().then(function(t){o.push(t),r()})):e(o)}var i=0,o=[];r()})}function o(t,n){return new u(function(e){function r(){t()?n().then(function(){return r()}):e()}r()})}n.wait=r,n.repeat=i,n.whilst=o;var u=e(23);Object.defineProperty(n,"__esModule",{value:!0})}])});
//# sourceMappingURL=hypertimer.map