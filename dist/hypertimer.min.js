/**
 * hypertimer.js
 * https://github.com/enmasseio/hypertimer
 *
 * Time control for simulations.
 *
 * Run a timer at a faster or slower pace than real-time, or run discrete events.
 *
 * @version 1.1.2-SNAPSHOT
 * @date    2015-02-19
 *
 * @license
 * Copyright (C) 2014-2015 Almende B.V., http://almende.com
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.hypertimer=t():e.hypertimer=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){function n(e){function t(e){if(d.length>0){for(var t=d.length-1;t>=0&&d[t].time>e.time;)t--;d.splice(t+1,0,e)}else d.push(e)}function r(e,r){function n(){e.type===o.INTERVAL&&v[e.id]&&(e.occurrence++,e.time=e.firstTime+e.occurrence*e.interval,t(e)),delete v[e.id],r&&r()}v[e.id]=e;try{0==e.callback.length?(e.callback(),n()):e.callback(n)}catch(i){n()}}function n(e){for(var t=0;t<d.length&&(d[t].time<=e||!isFinite(d[t].time));)t++;var r=d.splice(0,t);return 0==f&&i.shuffle(r),r}function u(){function e(){function e(){var n=t.shift();n?r(n,e):u()}a||(p=i>p&&isFinite(i)?i:p);var t=n(i);a?(t.forEach(r),u()):e()}if(a||!(Object.keys(v).length>0)){var t=d[0];if(T&&(clearTimeout(T),T=null),m&&t){var i=t.time,o=i-w.now(),f=a?o/c:0;T=setTimeout(e,Math.round(f))}}}var a=!0,c=1,f=!0,l=null,m=!1,s=null,p=i.systemNow(),d=[],v={},T=null,b=0,w={};return w.config=function(e){if(e){if("deterministic"in e&&(f=e.deterministic?!0:!1),"paced"in e&&(a=e.paced?!0:!1),"time"in e){if(e.time instanceof Date)p=e.time.valueOf();else{var t=Number(e.time);if(isNaN(t))throw new TypeError("Invalid time "+JSON.stringify(e.time)+". Time must be a Date or number");p=t}l=e.time}if("rate"in e){var r=Number(e.rate);if(isNaN(r)||0>=r)throw new TypeError("Invalid rate "+JSON.stringify(e.rate)+". Rate must be a positive number");p=w.now(),s=i.systemNow(),c=r}}return u(),{paced:a,rate:c,deterministic:f,time:l}},w.now=function(){if(a){if(m){var e=i.systemNow()-s,t=e*c;return p+t}return p}return p},w["continue"]=function(){s=i.systemNow(),m=!0,u()},w.pause=function(){p=w.now(),s=null,m=!1,u()},w.getTime=function(){return new Date(w.now())},w.valueOf=w.getTime,w.toString=function(){return w.getTime().toString()},w.setTimeout=function(e,r){var n=b++,i=w.now()+r;if(isNaN(i))throw new TypeError("delay must be a number");return t({id:n,type:o.TIMEOUT,time:i,callback:e}),u(),n},w.setTrigger=function(e,r){var n=b++,i=Number(r);if(isNaN(i))throw new TypeError("time must be a Date or number");return t({id:n,type:o.TRIGGER,time:i,callback:e}),u(),n},w.setInterval=function(e,r,n){var i=b++,a=Number(r);if(isNaN(a))throw new TypeError("interval must be a number");(0>a||!isFinite(a))&&(a=0);var c;if(void 0!=n){if(c=Number(n),isNaN(c))throw new TypeError("firstTime must be a Date or number")}else c=w.now()+a;return t({id:i,type:o.INTERVAL,interval:a,time:c,firstTime:c,occurrence:0,callback:e}),u(),i},w.clearTimeout=function(e){if(v[e])return void delete v[e];for(var t=0;t<d.length;t++)if(d[t].id===e){d.splice(t,1),u();break}},w.clearTrigger=w.clearTimeout,w.clearInterval=w.clearTimeout,w.list=function(){return d.map(function(e){return e.id})},w.clear=function(){v={},d=[],u()},Object.defineProperty(w,"running",{get:function(){return m}}),w.config(e),w.continue(),w}var i=r(2),o={TIMEOUT:0,INTERVAL:1,TRIGGER:2};e.exports=n},function(e,t){t.systemNow="function"==typeof Date.now?function(){return Date.now()}:function(){return(new Date).valueOf()},t.shuffle=function(e){for(var t,r,n=e.length;n;t=Math.floor(Math.random()*n),r=e[--n],e[n]=e[t],e[t]=r);return e}}])});
//# sourceMappingURL=hypertimer.map